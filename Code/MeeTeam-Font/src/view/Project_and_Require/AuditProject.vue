<template>
  <div id="AuditProject">
    <div id="body">
      <el-main>
        <div id="breadcrumb">
          <el-breadcrumb separator-class="el-icon-arrow-right">
            <el-breadcrumb-item :to="{ path: '/Admin/AdminPage' }"
              >首页</el-breadcrumb-item
            >
            <el-breadcrumb-item>审核管理</el-breadcrumb-item>
            <el-breadcrumb-item>项目审核</el-breadcrumb-item>
          </el-breadcrumb>
        </div>
        <el-card>
          <div class="filter-container">
            <el-input
              v-model="listQuery.project_name"
              placeholder="项目名称"
              style="width: 180px"
              class="filter-item"
              @keyup.enter.native="handleFilter"
            ></el-input>
            &nbsp;
            <el-input
              v-model="listQuery.publisher"
              placeholder="项目发布者"
              style="width: 180px"
              class="filter-item"
              @keyup.enter.native="handleFilter"
            ></el-input>
            &nbsp;
            <el-select
              v-model="listQuery.hav_require"
              placeholder="是否有组队需求"
              clearable
              style="width: 180px"
              class="filter-item"
            >
              <el-option
                v-for="item in statusOptions"
                :key="item.key"
                :label="item.display_name"
                :value="item.key"
              />
            </el-select>
            &nbsp;
            <el-button
              class="filter-item"
              type="primary"
              icon="el-icon-search"
              @click="handleFilter"
            >
              搜索
            </el-button>
          </div>
        </el-card>
        <br />
        <el-card>
          <el-table
            :data="tableData"
            :header-cell-style="{ textAlign: 'center' }"
            :cell-style="{ 'text-align': 'center' }"
          >
            <el-table-column prop="project_name" label="项目名称" width="160">
            </el-table-column>
            <el-table-column prop="project_introduction" label="项目简介" width="240">
            </el-table-column>
            <el-table-column prop="User_Projectuser_id" label="发布者" width="180">
            </el-table-column>
            <el-table-column prop="create_time" label="发布时间" sortable width="180">
            </el-table-column>
            <el-table-column prop="project_status" label="是否有组队需求" width="160">
            </el-table-column>
            <el-table-column label="操作">
              <template slot-scope="scope">
                <el-button size="mini" @click="handleCheck(scope.$index, scope.row)"
                  >查看详情</el-button
                >
              </template>
            </el-table-column>
          </el-table>
        </el-card>
      </el-main>
    </div>
  </div>
</template>

<script>
import global_msg from "../../utils/global.js";
import { getlistInfor } from "@/api/Inforlist.js";
import { getrequireInfor } from "@/api/Inforlist.js";
//import Pagination from "@/components/common/Pagination"; // secondary package based on el-pagination
import { get_username } from "@/api/ProjectDetail.js";
import { fetchList } from "@/api/Querylist.js";

const statusOptions = [
  { key: "1", display_name: "是" },
  { key: "0", display_name: "否" },
];

// arr to obj
const statusKeyValue = statusOptions.reduce((acc, cur) => {
  acc[cur.key] = cur.display_name;
  return acc;
}, {});

export default {
  name: "AuditProject",
  //components: { Pagination },
  filters: {
    statusFilter(status) {
      return statusKeyValue[status];
    },
  },
  data() {
    return {
      activeName: "项目列表",
      adminname: global_msg.nowadminid,
      tableData: [],
      total: 0,
      listQuery: {
        page: 1,
        //limit: 20,
        project_name: "",
        publisher: "",
        hav_require: "",
        require_id: "",
        require_status: "",
        team_type: "",
      },
      statusOptions,
    };
  },
  created() {
    this.getList(); //页面一进入就加载表格
  },
  methods: {
    getList() {
      var query = JSON.stringify(this.listQuery);
      fetchList(query).then((response) => {
        //console.log(response);
        this.tableData = response.data;
        console.log(this.tableData);
      });
    },
    handleFilter() {
      this.listQuery.page = 1;
      this.getList();
    },
    handleCheck(index, row) {
      //详情审核操作
      var project_id = this.tableData[index].project_id;
      console.log(index, row);
      this.$router.push({ path: "/Admin/DetailAudit", query: { p_id: project_id } });
    },
  },
};
</script>

<style>
.el-main {
  margin-left: 8%;
}

#body {
  position: relative;
  min-height: 100vh;
  height: 100%;
}

#breadcrumb {
  height: 30px;
  margin-bottom: 10px;
}
.el-card {
  box-shadow: 0 1px 1px rgba(0, 0, 0, 0, 15);
}
.filter-container {
  padding-bottom: 10px;

  .filter-item {
    display: inline-block;
    vertical-align: middle;
    margin-bottom: 10px;
  }
}
</style>
